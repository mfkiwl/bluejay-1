BLUEJAY := /home/seankent/bluejay
TOOLS := $(BLUEJAY)/tools
BUILD := $(BLUEJAY)/build

SOURCES_SV := $(wildcard $(BUILD)/*.sv)

COMP_OPTS_SV := \
	--incr \
	--relax

ELAB_OPTS := \
	--relax

TOP__TB := jay__tb


.PHONY: waves
waves: $(TOP__TB)__snapshot.wdb
	xsim --gui $(TOP__TB)__snapshot.wdb

$(TOP__TB)__snapshot.wdb: .elab.timestamp
	xsim $(TOP__TB)__snapshot --tclbatch xsim_cfg.tcl

.elab.timestamp : .comp_sv.timestamp
	xelab -debug all $(ELAB_OPTS) -top $(TOP__TB) -snapshot $(TOP__TB)__snapshot
	touch .elab.timestamp

.comp_sv.timestamp:
	xvlog --sv $(COMP_OPTS_SV) $(SOURCES_SV)
	touch .comp_sv.timestamp


.PHONY: clean 
clean:
	rm -rf *.jou *.log *.pb *.wdb xsim.dir # This deletes all files generated by Vivado
	rm -rf .*.timestamp # This deletes all our timestamps

.PHONY: compile
compile: .comp_sv.timestamp

.PHONY: elaborate
elaborate : .elab.timestamp

.PHONY: simulate
simulate : $(TOP__TB)__snapshot.wdb


